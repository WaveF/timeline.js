var Timeline=function(){this.name="Global",this.anims=[],this.time=0,this.totalTime=0,this.loopCount=0,this.loopMode=0,this.playing=!0;var self=this;this.fps=30,this.loopInterval=setInterval((function(){self.update()}),1e3/this.fps)};function Anim(name,target,timeline){this.startTime=0,this.endTime=0,this.time=0,this.propertyAnims=[],this.hasStarted=!1,this.hasEnded=!1,this.name=name,this.target=target,this.timeline=timeline,this.animGroups=[]}function anim(targetName,targetObject,parentTimeline){for(var args=[],i=0,name,target,timeline;i<arguments.length;i++)args.push(arguments[i]);return"string"==typeof args[0]&&(name=args.shift()),new Anim(name,target="object"==typeof args[0]?args.shift():{},timeline="object"==typeof args[0]?args.shift():Timeline.getGlobalInstance())}for(var easingFunctionFamilyName in Timeline.getGlobalInstance=function(){return Timeline.globalInstance||(Timeline.globalInstance=new Timeline),Timeline.globalInstance},Timeline.prototype.loop=function(n){this.loopMode=n},Timeline.prototype.stop=function(){this.playing=!1,this.time=0},Timeline.prototype.pause=function(){this.playing=!1},Timeline.prototype.play=function(){this.playing=!0},Timeline.prototype.preUpdate=function(){},Timeline.prototype.update=function(deltaTime){if(void 0!==deltaTime?0!==this.loopInterval&&(clearInterval(this.loopInterval),this.loopInterval=0):deltaTime=1/this.fps,this.preUpdate(),this.playing&&(this.totalTime+=deltaTime,this.time+=deltaTime),0!==this.loopMode){var animationEnd=this.findAnimationEnd();if(this.time>animationEnd)if(-1==this.loopMode||this.loopCount<this.loopMode){this.time=0,this.loopCount++;for(var i=0;i<this.anims.length;i++)this.anims[i].hasStarted=!1,this.anims[i].hasEnded=!1}else this.playing=!1}this.applyValues()},Timeline.prototype.findAnimationEnd=function(){for(var endTime=0,i=0;i<this.anims.length;i++)this.anims[i].endTime>endTime&&(endTime=this.anims[i].endTime);return endTime},Timeline.prototype.applyValues=function(){for(var i=0;i<this.anims.length;i++){var propertyAnim=this.anims[i];if(!(this.time<propertyAnim.startTime||propertyAnim.hasEnded)){if(this.time>=propertyAnim.startTime&&!propertyAnim.hasStarted){var startValue=propertyAnim.target[propertyAnim.propertyName];startValue.length&&startValue.indexOf("px")>-1?(propertyAnim.startValue=Number(startValue.replace("px","")),propertyAnim.unit="px"):propertyAnim.startValue=Number(startValue),propertyAnim.hasStarted=!0,propertyAnim.onStart&&propertyAnim.onStart()}var duration=propertyAnim.endTime-propertyAnim.startTime,t=duration?(this.time-propertyAnim.startTime)/duration:1;t=Math.max(0,Math.min(t,1)),t=propertyAnim.easing(t);var value=propertyAnim.startValue+(propertyAnim.endValue-propertyAnim.startValue)*t;propertyAnim.unit&&(value+=propertyAnim.unit),propertyAnim.target[propertyAnim.propertyName]=value,propertyAnim.parent&&propertyAnim.parent.onUpdateCallback&&propertyAnim.parent.onUpdateCallback(propertyAnim),this.time>=propertyAnim.endTime&&!propertyAnim.hasEnded&&(propertyAnim.hasEnded=!0,propertyAnim.onEnd&&propertyAnim.onEnd()),1==t&&0==this.loopMode&&(this.anims.splice(i,1),i--)}}},Anim.prototype.to=function(){for(var args=[],i=0,delay,properties,duration,easing;i<arguments.length;i++)args.push(arguments[i]);delay="number"==typeof args[0]?args.shift():0,properties="object"==typeof args[0]?args.shift():{},duration="number"==typeof args[0]?args.shift():1,easing="function"==typeof args[0]?args.shift():Timeline.Easing.Linear.EaseNone;var animGroup=[],nop=function(){};for(var propertyName in properties){var animInfo={hasStarted:!1,timeline:this.timeline,targetName:this.name,target:this.target,propertyName:propertyName,endValue:properties[propertyName],delay:delay,startTime:this.timeline.time+delay+this.endTime,endTime:this.timeline.time+delay+this.endTime+duration,easing:easing,parent:this,onStart:nop,onEnd:nop};this.timeline.anims.push(animInfo),animGroup.push(animInfo)}return this.animGroups.push(animGroup),this.endTime+=delay+duration,this},Anim.prototype.onStart=function(callback){var currentAnimGroup=this.animGroups[this.animGroups.length-1];if(currentAnimGroup){var called=!1;return currentAnimGroup.forEach((function(anim){anim.onStart=function(){called||(called=!0,callback())}})),this}},Anim.prototype.onUpdate=function(callback){var self=this;return this.onUpdateCallback=function(){callback()},this},Anim.prototype.onEnd=function(callback){var currentAnimGroup=this.animGroups[this.animGroups.length-1];if(currentAnimGroup){var called=!1;return currentAnimGroup.forEach((function(anim){anim.onEnd=function(){called||(called=!0,callback())}})),this}},Timeline.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},Timeline.Easing.Linear.EaseNone=function(k){return k},Timeline.Easing.Quadratic.EaseIn=function(k){return k*k},Timeline.Easing.Quadratic.EaseOut=function(k){return-k*(k-2)},Timeline.Easing.Quadratic.EaseInOut=function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)},Timeline.Easing.Cubic.EaseIn=function(k){return k*k*k},Timeline.Easing.Cubic.EaseOut=function(k){return--k*k*k+1},Timeline.Easing.Cubic.EaseInOut=function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)},Timeline.Easing.Elastic.EaseIn=function(k){var s,a=.1,p=.4;return 0===k?0:1==k?1:(p||(p=.3),!a||a<1?(a=1,s=p/4):s=p/(2*Math.PI)*Math.asin(1/a),-a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Timeline.Easing.Elastic.EaseOut=function(k){var s,a=.1,p=.4;return 0===k?0:1==k?1:(p||(p=.3),!a||a<1?(a=1,s=p/4):s=p/(2*Math.PI)*Math.asin(1/a),a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},Timeline.Easing.Elastic.EaseInOut=function(k){var s,a=.1,p=.4;return 0===k?0:1==k?1:(p||(p=.3),!a||a<1?(a=1,s=p/4):s=p/(2*Math.PI)*Math.asin(1/a),(k*=2)<1?a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*-.5:a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1)},Timeline.Easing.Back.EaseIn=function(k){var s=1.70158;return k*k*((s+1)*k-s)},Timeline.Easing.Back.EaseOut=function(k){var s=1.70158;return(k-=1)*k*((s+1)*k+s)+1},Timeline.Easing.Back.EaseInOut=function(k){var s=2.5949095;return(k*=2)<1?k*k*((s+1)*k-s)*.5:.5*((k-=2)*k*((s+1)*k+s)+2)},Timeline.Easing.Bounce.EaseIn=function(k){return 1-Timeline.Easing.Bounce.EaseOut(1-k)},Timeline.Easing.Bounce.EaseOut=function(k){return(k/=1)<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},Timeline.Easing.Bounce.EaseInOut=function(k){return k<.5?.5*Timeline.Easing.Bounce.EaseIn(2*k):.5*Timeline.Easing.Bounce.EaseOut(2*k-1)+.5},Timeline.easingFunctionToString=function(f){for(var name in Timeline.easingMap)if(Timeline.easingMap[name]==f)return name},Timeline.stringToEasingFunction=function(name){return Timeline.easingMap[name]},Timeline.easingMap={},Timeline.Easing){var easingFunctionFamily=Timeline.Easing[easingFunctionFamilyName];for(var easingFunctionName in easingFunctionFamily)Timeline.easingMap[easingFunctionFamilyName+"."+easingFunctionName]=easingFunctionFamily[easingFunctionName]}"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.Timeline=Timeline,module.exports.Anim=Anim,module.exports.anim=anim);