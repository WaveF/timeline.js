(function(t){function n(t,n,i){this.startTime=0,this.endTime=0,this.time=0,this.propertyAnims=[],this.hasStarted=!1,this.hasEnded=!1,this.name=t,this.target=n,this.timeline=i,this.animGroups=[]}function i(t,i,a){for(var s,o,r,u=[],h=0;h<arguments.length;h++)u.push(arguments[h]);return"string"==typeof u[0]&&(s=u.shift()),o="object"==typeof u[0]?u.shift():{},r="object"==typeof u[0]?u.shift():e.getGlobalInstance(),new n(s,o,r)}var e=function(){this.name="Global",this.anims=[],this.time=0,this.totalTime=0,this.loopCount=0,this.loopMode=0,this.playing=!0;var t=this;this.fps=30,this.loopInterval=setInterval(function(){t.update()},1e3/this.fps)};for(var a in e.getGlobalInstance=function(){return e.globalInstance||(e.globalInstance=new e),e.globalInstance},e.prototype.loop=function(t){this.loopMode=t},e.prototype.stop=function(){this.playing=!1,this.time=0},e.prototype.pause=function(){this.playing=!1},e.prototype.play=function(){this.playing=!0},e.prototype.preUpdate=function(){},e.prototype.update=function(t){if(void 0!==t?0!==this.loopInterval&&(clearInterval(this.loopInterval),this.loopInterval=0):t=1/this.fps,this.preUpdate(),this.playing&&(this.totalTime+=t,this.time+=t),0!==this.loopMode){var n=this.findAnimationEnd();if(this.time>n)if(-1==this.loopMode||this.loopCount<this.loopMode){this.time=0,this.loopCount++;for(var i=0;i<this.anims.length;i++)this.anims[i].hasStarted=!1,this.anims[i].hasEnded=!1}else this.playing=!1}this.applyValues()},e.prototype.findAnimationEnd=function(){for(var t=0,n=0;n<this.anims.length;n++)this.anims[n].endTime>t&&(t=this.anims[n].endTime);return t},e.prototype.applyValues=function(){for(var t=0;t<this.anims.length;t++){var n=this.anims[t];if(!(this.time<n.startTime||n.hasEnded)){if(this.time>=n.startTime&&!n.hasStarted){var i=n.target[n.propertyName];i.length&&i.indexOf("px")>-1?(n.startValue=Number(i.replace("px","")),n.unit="px"):n.startValue=Number(i),n.hasStarted=!0,n.onStart&&n.onStart()}var e=n.endTime-n.startTime,a=e?(this.time-n.startTime)/e:1;a=Math.max(0,Math.min(a,1)),a=n.easing(a);var s=n.startValue+(n.endValue-n.startValue)*a;n.unit&&(s+=n.unit),n.target[n.propertyName]=s,n.parent&&n.parent.onUpdateCallback&&n.parent.onUpdateCallback(n),this.time>=n.endTime&&!n.hasEnded&&(n.hasEnded=!0,n.onEnd&&n.onEnd()),1==a&&0==this.loopMode&&(this.anims.splice(t,1),t--)}}},n.prototype.to=function(){for(var t,n,i,a,s=[],o=0;o<arguments.length;o++)s.push(arguments[o]);t="number"==typeof s[0]?s.shift():0,n="object"==typeof s[0]?s.shift():{},i="number"==typeof s[0]?s.shift():1,a="function"==typeof s[0]?s.shift():e.Easing.Linear.EaseNone;var r=[],u=function(){};for(var h in n){var p={hasStarted:!1,timeline:this.timeline,targetName:this.name,target:this.target,propertyName:h,endValue:n[h],delay:t,startTime:this.timeline.time+t+this.endTime,endTime:this.timeline.time+t+this.endTime+i,easing:a,parent:this,onStart:u,onEnd:u};this.timeline.anims.push(p),r.push(p)}return this.animGroups.push(r),this.endTime+=t+i,this},n.prototype.onStart=function(t){var n=this.animGroups[this.animGroups.length-1];if(n){var i=!1;return n.forEach(function(n){n.onStart=function(){i||(i=!0,t())}}),this}},n.prototype.onUpdate=function(t){return this.onUpdateCallback=function(){t()},this},n.prototype.onEnd=function(t){var n=this.animGroups[this.animGroups.length-1];if(n){var i=!1;return n.forEach(function(n){n.onEnd=function(){i||(i=!0,t())}}),this}},e.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},e.Easing.Linear.EaseNone=function(t){return t},e.Easing.Quadratic.EaseIn=function(t){return t*t},e.Easing.Quadratic.EaseOut=function(t){return-t*(t-2)},e.Easing.Quadratic.EaseInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},e.Easing.Cubic.EaseIn=function(t){return t*t*t},e.Easing.Cubic.EaseOut=function(t){return--t*t*t+1},e.Easing.Cubic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},e.Easing.Elastic.EaseIn=function(t){var n,i=.1,e=.4;return 0===t?0:1==t?1:(e||(e=.3),!i||i<1?(i=1,n=e/4):n=e/(2*Math.PI)*Math.asin(1/i),-i*Math.pow(2,10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/e))},e.Easing.Elastic.EaseOut=function(t){var n,i=.1,e=.4;return 0===t?0:1==t?1:(e||(e=.3),!i||i<1?(i=1,n=e/4):n=e/(2*Math.PI)*Math.asin(1/i),i*Math.pow(2,-10*t)*Math.sin((t-n)*(2*Math.PI)/e)+1)},e.Easing.Elastic.EaseInOut=function(t){var n,i=.1,e=.4;return 0===t?0:1==t?1:(e||(e=.3),!i||i<1?(i=1,n=e/4):n=e/(2*Math.PI)*Math.asin(1/i),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/e)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/e)*.5+1)},e.Easing.Back.EaseIn=function(t){var n=1.70158;return t*t*((n+1)*t-n)},e.Easing.Back.EaseOut=function(t){var n=1.70158;return(t-=1)*t*((n+1)*t+n)+1},e.Easing.Back.EaseInOut=function(t){var n=2.5949095;return(t*=2)<1?t*t*((n+1)*t-n)*.5:.5*((t-=2)*t*((n+1)*t+n)+2)},e.Easing.Bounce.EaseIn=function(t){return 1-e.Easing.Bounce.EaseOut(1-t)},e.Easing.Bounce.EaseOut=function(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},e.Easing.Bounce.EaseInOut=function(t){return t<.5?.5*e.Easing.Bounce.EaseIn(2*t):.5*e.Easing.Bounce.EaseOut(2*t-1)+.5},e.easingFunctionToString=function(t){for(var n in e.easingMap)if(e.easingMap[n]==t)return n},e.stringToEasingFunction=function(t){return e.easingMap[t]},e.easingMap={},e.Easing){var s=e.Easing[a];for(var o in s)e.easingMap[a+"."+o]=s[o]}e.anim=i,"function"==typeof define&&define.amd?define("Timeline",e):"object"==typeof module&&"object"==typeof exports?module.exports.TimelineJS=e:"object"==typeof exports?exports.TimelineJS=e:t.Timeline=e})(this);