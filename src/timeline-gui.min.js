Timeline.prototype.initGUI=function(){var t=this;this.trackLabelWidth=108,this.trackLabelHeight=20,this.tracksScrollWidth=16,this.tracksScrollHeight=0,this.tracksScrollThumbPos=0,this.tracksScrollThumbHeight=0,this.tracksScrollY=0,this.timeScrollWidth=0,this.timeScrollHeight=16,this.timeScrollThumbPos=0,this.timeScrollThumbWidth=0,this.timeScrollX=0,this.headerHeight=30,this.canvasHeight=200,this.draggingTime=!1,this.draggingTracksScrollThumb=!1,this.draggingTimeScrollThumb=!1,this.draggingKeys=!1,this.draggingTimeScale=!1,this.selectedKeys=[],this.timeScale=1,this.trackNameCounter=0,this.initTracks(),this.load(),this.container=document.createElement("div"),this.container.style.width="100%",this.container.style.height=this.canvasHeight+"px",this.container.style.background="#EEEEEE",this.container.style.position="fixed",this.container.style.left="0px",this.container.style.bottom="0px",this.container.style.transition=".5s bottom",document.body.appendChild(this.container),this.splitter=document.createElement("div"),this.splitter.style.width="100%",this.splitter.style.height="4px",this.splitter.style.cursor="ns-resize",this.splitter.style.position="fixed",this.splitter.style.left="0px",this.splitter.style.bottom=this.canvasHeight-2+"px",this.splitter.addEventListener("mousedown",function(i){function e(i){var e=window.innerHeight-i.clientY;t.splitter.style.bottom=e-2+"px",t.container.style.height=e+"px",t.canvasHeight=e,t.tracksScrollY=0,t.tracksScrollThumbPos=0,t.save()}function s(t){document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",s,!1)}i.preventDefault(),document.addEventListener("mousemove",e,!1),document.addEventListener("mouseup",s,!1)},!1),this.container.appendChild(this.splitter),this.canvas=document.createElement("canvas"),this.c=this.canvas.getContext("2d"),this.canvas.width=0,this.container.appendChild(this.canvas),this.buildInputDialog(),this.canvas.addEventListener("click",function(i){t.onMouseClick(i)},!1),this.canvas.addEventListener("mousedown",function(i){t.onMouseDown(i)},!1),document.body.addEventListener("mousemove",function(i){t.onDocumentMouseMove(i)},!1),this.canvas.addEventListener("mousemove",function(i){t.onCanvasMouseMove(i)},!1),document.body.addEventListener("mouseup",function(i){t.onMouseUp(i)},!1),this.canvas.addEventListener("dblclick",function(i){t.onMouseDoubleClick(i)},!1)},Timeline.prototype.onMouseDown=function(t){this.selectedKeys=[];var i=t.layerX,e=t.layerY;i>this.trackLabelWidth&&e<this.headerHeight?(this.draggingTime=!0,this.onCanvasMouseMove(t)):i>this.canvas.width-this.tracksScrollWidth&&e>this.headerHeight?e>=this.headerHeight+this.tracksScrollThumbPos&&e<=this.headerHeight+this.tracksScrollThumbPos+this.tracksScrollThumbHeight&&(this.tracksScrollThumbDragOffset=e-this.headerHeight-this.tracksScrollThumbPos,this.draggingTracksScrollThumb=!0):i>this.trackLabelWidth&&e>this.headerHeight&&e<this.canvasHeight-this.timeScrollHeight?(this.selectKeys(t.layerX,t.layerY),this.selectedKeys.length>0&&(this.draggingKeys=!0),this.cancelKeyClick=!1):i<this.trackLabelWidth&&e>this.canvasHeight-this.timeScrollHeight?(this.timeScale=Math.max(.01,Math.min((this.trackLabelWidth-i)/this.trackLabelWidth,1)),this.draggingTimeScale=!0,this.save()):i>this.trackLabelWidth&&e>this.canvasHeight-this.timeScrollHeight&&i>=this.trackLabelWidth+this.timeScrollThumbPos&&i<=this.trackLabelWidth+this.timeScrollThumbPos+this.timeScrollThumbWidth&&(this.timeScrollThumbDragOffset=i-this.trackLabelWidth-this.timeScrollThumbPos,this.draggingTimeScrollThumb=!0)},Timeline.prototype.onDocumentMouseMove=function(t){var i=t.layerX;t.layerY;if(this.draggingTime){this.time=this.xToTime(i);var e=this.findAnimationEnd();this.time<0&&(this.time=0),this.time>e&&(this.time=e)}if(this.draggingKeys){for(var s=0;s<this.selectedKeys.length;s++){var h=this.selectedKeys[s];h.time=Math.max(0,this.xToTime(i)),this.sortTrackKeys(h.track),this.rebuildSelectedTracks()}this.cancelKeyClick=!0,this.timeScrollThumbPos=this.timeScrollX*(this.timeScrollWidth-this.timeScrollThumbWidth)}this.draggingTimeScale&&(this.timeScale=Math.max(.01,Math.min((this.trackLabelWidth-i)/this.trackLabelWidth,1)),this.save())},Timeline.prototype.onCanvasMouseMove=function(t){var i=t.layerX,e=t.layerY;this.draggingTracksScrollThumb&&(this.tracksScrollThumbPos=e-this.headerHeight-this.tracksScrollThumbDragOffset,this.tracksScrollThumbPos<0&&(this.tracksScrollThumbPos=0),this.tracksScrollThumbPos+this.tracksScrollThumbHeight>this.tracksScrollHeight&&(this.tracksScrollThumbPos=Math.max(0,this.tracksScrollHeight-this.tracksScrollThumbHeight)),this.tracksScrollHeight-this.tracksScrollThumbHeight>0?this.tracksScrollY=this.tracksScrollThumbPos/(this.tracksScrollHeight-this.tracksScrollThumbHeight):this.tracksScrollY=0),this.draggingTimeScrollThumb&&(this.timeScrollThumbPos=i-this.trackLabelWidth-this.timeScrollThumbDragOffset,this.timeScrollThumbPos<0&&(this.timeScrollThumbPos=0),this.timeScrollThumbPos+this.timeScrollThumbWidth>this.timeScrollWidth&&(this.timeScrollThumbPos=Math.max(0,this.timeScrollWidth-this.timeScrollThumbWidth)),this.timeScrollWidth-this.timeScrollThumbWidth>0?this.timeScrollX=this.timeScrollThumbPos/(this.timeScrollWidth-this.timeScrollThumbWidth):this.timeScrollX=0)},Timeline.prototype.onMouseUp=function(t){this.draggingTime&&(this.draggingTime=!1),this.draggingKeys&&(this.draggingKeys=!1),this.draggingTracksScrollThumb&&(this.draggingTracksScrollThumb=!1),this.draggingTimeScale&&(this.draggingTimeScale=!1),this.draggingTimeScrollThumb&&(this.draggingTimeScrollThumb=!1)},Timeline.prototype.onMouseClick=function(t){t.layerX<1*this.headerHeight-0&&t.layerY<this.headerHeight&&this.play(),t.layerX>1*this.headerHeight-0&&t.layerX<2*this.headerHeight-4&&t.layerY<this.headerHeight&&this.pause(),t.layerX>2*this.headerHeight-4&&t.layerX<3*this.headerHeight-8&&t.layerY<this.headerHeight&&this.stop(),t.layerX>3*this.headerHeight-8&&t.layerX<4*this.headerHeight-12&&t.layerY<this.headerHeight&&this.exportCode(),this.selectedKeys.length>0&&!this.cancelKeyClick&&this.showKeyEditDialog(t.pageX,t.pageY)},Timeline.prototype.onMouseDoubleClick=function(t){var i=t.layerX,e=t.layerY;if(i>this.trackLabelWidth&&e<this.headerHeight){var s=prompt("Enter time")||"0:0:0",h=s.split(":"),a=0,l=0,r=0;h.length>0&&(a=parseInt(h[h.length-1],10)),h.length>1&&(l=parseInt(h[h.length-2],10)),h.length>2&&(r=parseInt(h[h.length-3],10)),this.time=this.totalTime=60*r*60+60*l+a}else i>this.trackLabelWidth&&0===this.selectedKeys.length&&e>this.headerHeight&&e<this.canvasHeight-this.timeScrollHeight&&this.addKeyAt(i,e)},Timeline.prototype.addKeyAt=function(t,i){var e=this.getTrackAt(t,i);if(e){var s={time:this.xToTime(t),value:e.target[e.propertyName],easing:Timeline.Easing.Linear.EaseNone,track:e};if(0===e.keys.length)e.keys.push(s);else if(s.time<e.keys[0].time)s.value=e.keys[0].value,e.keys.unshift(s);else if(s.time>e.keys[e.keys.length-1].time)s.value=e.keys[e.keys.length-1].value,e.keys.push(s);else for(var h=1;h<e.keys.length;h++)if(e.keys[h].time>s.time){var a=(e.keys[h].time-s.time)/(e.keys[h].time-e.keys[h-1].time),l=e.keys[h].value-e.keys[h-1].value;s.easing=e.keys[h-1].easing,s.value=e.keys[h-1].value+l*s.easing(a),e.keys.splice(h,0,s);break}this.selectedKeys=[s],this.rebuildSelectedTracks()}},Timeline.prototype.getTrackAt=function(t,i){var e=this.tracksScrollY*(this.tracks.length*this.trackLabelHeight-this.canvas.height+this.headerHeight),s=Math.floor((i-this.headerHeight+e)/this.trackLabelHeight);return s>=0&&s>=this.tracks.length||"object"==this.tracks[s].type?null:this.tracks[s]},Timeline.prototype.selectKeys=function(t,i){this.selectedKeys=[];var e=this.getTrackAt(t,i);if(e)for(var s=0;s<e.keys.length;s++){var h=e.keys[s],a=this.timeToX(h.time);if(a>=t-.3*this.trackLabelHeight&&a<=t+.3*this.trackLabelHeight){this.selectedKeys.push(h);break}}},Timeline.prototype.preUpdate=function(){this.updateGUI()},Timeline.prototype.updateGUI=function(){this.canvas||this.initGUI(),this.canvas.width=window.innerWidth,this.canvas.height=this.canvasHeight;var t=this.canvas.width,i=this.canvas.height;this.tracksScrollHeight=this.canvas.height-this.headerHeight-this.timeScrollHeight;var e=this.tracks.length*this.trackLabelHeight,s=this.tracksScrollHeight/e;this.tracksScrollThumbHeight=Math.min(Math.max(20,this.tracksScrollHeight*s),this.tracksScrollHeight),this.timeScrollWidth=this.canvas.width-this.trackLabelWidth-this.tracksScrollWidth;var h=this.findAnimationEnd(),a=this.xToTime(this.canvas.width-this.trackLabelWidth-this.tracksScrollWidth)-this.xToTime(0),l=Math.max(0,Math.min(a/h,1));this.timeScrollThumbWidth=l*this.timeScrollWidth,this.timeScrollThumbPos+this.timeScrollThumbWidth>this.timeScrollWidth&&(this.timeScrollThumbPos=Math.max(0,this.timeScrollWidth-this.timeScrollThumbWidth)),this.c.clearRect(0,0,t,i),this.drawRect(0*this.headerHeight- -4,5,this.headerHeight-8,this.headerHeight-8,"#DDDDDD"),this.drawRect(1*this.headerHeight-0,5,this.headerHeight-8,this.headerHeight-8,"#DDDDDD"),this.drawRect(2*this.headerHeight-4,5,this.headerHeight-8,this.headerHeight-8,"#DDDDDD"),this.drawRect(3*this.headerHeight-8,5,this.headerHeight-8,this.headerHeight-8,"#DDDDDD"),this.c.strokeStyle="#777777",this.c.beginPath(),this.c.moveTo(10.5,10),this.c.lineTo(this.headerHeight-8,this.headerHeight/2+1.5),this.c.lineTo(10.5,this.headerHeight-8),this.c.lineTo(10.5,10),this.c.stroke(),this.c.strokeRect(this.headerHeight+5.5,10.5,this.headerHeight/6,this.headerHeight-8-11),this.c.strokeRect(this.headerHeight+5.5+this.headerHeight/6+2,10.5,this.headerHeight/6,this.headerHeight-8-11),this.c.strokeRect(2*this.headerHeight-4+5.5,10.5,this.headerHeight-8-11,this.headerHeight-8-11),this.c.beginPath(),this.c.moveTo(3*this.headerHeight-8+5.5,this.headerHeight-9.5),this.c.lineTo(3*this.headerHeight-8+11.5,this.headerHeight-9.5),this.c.moveTo(3*this.headerHeight-8+5.5,this.headerHeight-13.5),this.c.lineTo(3*this.headerHeight-8+13.5,this.headerHeight-13.5),this.c.moveTo(3*this.headerHeight-8+5.5,this.headerHeight-17.5),this.c.lineTo(3*this.headerHeight-8+15.5,this.headerHeight-17.5),this.c.stroke(),this.c.save(),this.c.beginPath(),this.c.moveTo(0,this.headerHeight+1),this.c.lineTo(this.canvas.width,this.headerHeight+1),this.c.lineTo(this.canvas.width,this.canvas.height-this.timeScrollHeight),this.c.lineTo(0,this.canvas.height-this.timeScrollHeight),this.c.clip();for(var r=0;r<this.tracks.length;r++){var c=this.headerHeight+this.trackLabelHeight*(r+1),o=this.tracksScrollY*(this.tracks.length*this.trackLabelHeight-this.canvas.height+this.headerHeight);c-=o,c<this.headerHeight||this.drawTrack(this.tracks[r],c)}this.c.restore(),this.drawLine(this.trackLabelWidth,0,this.trackLabelWidth,i,"#000000");var n=0,d=0;this.c.fillStyle="#666666";for(var g=this.timeToX(0),m=n;g<this.canvas.width;){g=this.timeToX(m),this.drawLine(g,0,g,.3*this.headerHeight,"#999999");var k=Math.floor(m/60),y=m%60,u=k+":"+(y<10?"0":"")+y;g-d>30&&(this.c.fillText(u,g-6,.8*this.headerHeight),d=g),m+=1}this.drawLine(this.timeToX(this.time),0,this.timeToX(this.time),i,"#FF0000");for(var p=2;p<20;p++){var T=1-p*p/361;this.drawLine(7+T*(this.trackLabelWidth-10),i-this.timeScrollHeight+4,7+T*(this.trackLabelWidth-10),i-3,"#999999")}this.c.fillStyle="#666666",this.c.beginPath(),this.c.moveTo(7+(1-this.timeScale)*(this.trackLabelWidth-10),i-7),this.c.lineTo(11+(1-this.timeScale)*(this.trackLabelWidth-10),i-1),this.c.lineTo(3+(1-this.timeScale)*(this.trackLabelWidth-10),i-1),this.c.fill(),this.drawRect(this.canvas.width-this.tracksScrollWidth,this.headerHeight+1,this.tracksScrollWidth,this.tracksScrollHeight,"#DDDDDD"),this.tracksScrollThumbHeight<this.tracksScrollHeight&&this.drawRect(this.canvas.width-this.tracksScrollWidth,this.headerHeight+1+this.tracksScrollThumbPos,this.tracksScrollWidth,this.tracksScrollThumbHeight,"#999999"),this.drawRect(this.trackLabelWidth,i-this.timeScrollHeight,t-this.trackLabelWidth-this.tracksScrollWidth,this.timeScrollHeight,"#DDDDDD"),this.timeScrollThumbWidth<this.timeScrollWidth&&this.drawRect(this.trackLabelWidth+1+this.timeScrollThumbPos,i-this.timeScrollHeight,this.timeScrollThumbWidth,this.timeScrollHeight,"#999999"),this.drawLine(0,0,t,0,"#000000"),this.drawLine(0,this.headerHeight,t,this.headerHeight,"#000000"),this.drawLine(0,i-this.timeScrollHeight,this.trackLabelWidth,i-this.timeScrollHeight,"#000000"),this.drawLine(this.trackLabelWidth,i-this.timeScrollHeight-1,this.trackLabelWidth,i,"#000000")},Timeline.prototype.timeToX=function(t){var i=this.findAnimationEnd(),e=this.xToTime(this.canvas.width-this.trackLabelWidth-this.tracksScrollWidth)-this.xToTime(20);return e<i&&(t-=(i-e)*this.timeScrollX),this.trackLabelWidth+t*(200*this.timeScale)+10},Timeline.prototype.xToTime=function(t){var i=this.findAnimationEnd(),e=(this.canvas.width-this.trackLabelWidth-this.tracksScrollWidth-20)/(200*this.timeScale),s=Math.max(0,(i-e)*this.timeScrollX);return(t-this.trackLabelWidth-10)/(200*this.timeScale)+s},Timeline.prototype.drawTrack=function(t,i){var e=5;if("object"==t.type?(this.drawRect(0,i-this.trackLabelHeight+1,this.trackLabelWidth,this.trackLabelHeight-1,"#FFFFFF"),this.c.fillStyle="#000000"):(e+=10,this.c.fillStyle="#555555"),this.drawLine(0,i,this.canvas.width,i,"#FFFFFF"),this.c.fillText(t.name,e,i-this.trackLabelHeight/4),"property"==t.type)for(var s=0;s<t.keys.length;s++){var h=t.keys[s],a=!1;this.selectedKeys.indexOf(h)>-1&&(a=!0);var l=0===s,r=s==t.keys.length-1;this.drawRombus(this.timeToX(h.time),i-.5*this.trackLabelHeight,.5*this.trackLabelHeight,.5*this.trackLabelHeight,"#999999",!0,!0,a?"#FF0000":"#666666"),this.drawRombus(this.timeToX(h.time),i-.5*this.trackLabelHeight,.5*this.trackLabelHeight,.5*this.trackLabelHeight,"#DDDDDD",!l,!r)}},Timeline.prototype.drawLine=function(t,i,e,s,h){this.c.strokeStyle=h,this.c.beginPath(),this.c.moveTo(t+.5,i+.5),this.c.lineTo(e+.5,s+.5),this.c.stroke()},Timeline.prototype.drawRect=function(t,i,e,s,h){this.c.fillStyle=h,this.c.fillRect(t,i,e,s)},Timeline.prototype.drawCenteredRect=function(t,i,e,s,h){this.c.fillStyle=h,this.c.fillRect(t-e/2,i-s/2,e,s)},Timeline.prototype.drawRombus=function(t,i,e,s,h,a,l,r){this.c.fillStyle=h,r&&(this.c.lineWidth=2,this.c.strokeStyle=r,this.c.beginPath(),this.c.moveTo(t,i-s/2),this.c.lineTo(t+e/2,i),this.c.lineTo(t,i+s/2),this.c.lineTo(t-e/2,i),this.c.lineTo(t,i-s/2),this.c.stroke(),this.c.lineWidth=1),a&&(this.c.beginPath(),this.c.moveTo(t,i-s/2),this.c.lineTo(t-e/2,i),this.c.lineTo(t,i+s/2),this.c.fill()),l&&(this.c.beginPath(),this.c.moveTo(t,i-s/2),this.c.lineTo(t+e/2,i),this.c.lineTo(t,i+s/2),this.c.fill())},Timeline.prototype.initTracks=function(){var t,i,e;for(this.tracks=[],t=0;t<this.anims.length;t++){e=this.anims[t];var s=null,h=null;for(i=0;i<this.tracks.length;i++)"object"==this.tracks[i].type&&this.tracks[i].target==e.target&&(s=this.tracks[i]),"property"==this.tracks[i].type&&this.tracks[i].target==e.target&&this.tracks[i].propertyName==e.propertyName&&(h=this.tracks[i]);if(s||(s={type:"object",id:e.targetName,name:e.targetName,target:e.target,propertyTracks:[]},s.name||(s.name="Object"+this.trackNameCounter++),this.tracks.push(s)),!h){h={type:"property",id:s.name+"."+e.propertyName,name:e.propertyName,propertyName:e.propertyName,target:e.target,parent:s,anims:[]};for(var a=null,l=null,r=0;r<this.tracks.length;r++)"object"==this.tracks[r].type&&(a&&!l&&(l=this.tracks[r]),this.tracks[r].target==h.target&&(a=this.tracks[r]));if(l){var c=this.tracks.indexOf(l);this.tracks.splice(c,0,h)}else this.tracks.push(h);a.propertyTracks.push(h)}h.anims.push(e)}for(t=0;t<this.tracks.length;t++){var o=this.tracks[t];if(o.keys=[],"object"!=o.type)for(i=0;i<o.anims.length;i++){if(e=o.anims[i],e.delay>0){var n=0,d=e.easing;n=0===i?o.target[o.propertyName]:o.anims[i-1].endValue,o.keys.push({time:e.startTime,value:n,easing:d,track:o})}var g=Timeline.Easing.Linear.EaseNone;i<o.anims.length-1&&0===o.anims[i+1].delay&&(g=o.anims[i+1].easing),o.keys.push({time:e.endTime,value:e.endValue,easing:g,track:o})}}},Timeline.prototype.buildInputDialog=function(){this.keyEditDialog=document.createElement("div"),this.keyEditDialog.id="keyEditDialog",this.keyEditDialog.style.cssText="position:absolute; padding:5px; background: #DDDDDD; font-family:arial; font-size:11px; left: 100px; top:100px; border: 1px solid #AAAAAA; border-radius: 5px;";var t="";for(var i in Timeline.Easing){var e=Timeline.Easing[i];for(var s in e)t+="<option>"+i+"."+s+"</option>"}var h="";h+='<label style="margin-right:10px">Value<input type="text" id="keyEditDialogValue"/></label>',h+='<label style="margin-right:10px">Easing<select id="keyEditDialogEasing">'+t+"</label>",h+='<input id="keyEditDialogOK" style="margin-left: 10px; margin-right:10px" type="button" value="OK"/>',h+='<input id="keyEditDialogCancel" style="margin-right:10px" type="button" value="Cancel"/>',h+='<a id="keyEditDialogDelete" style="margin-right:5px" href="#">[x]</a>',this.keyEditDialog.innerHTML=h,document.body.appendChild(this.keyEditDialog),this.keyEditDialogValue=document.getElementById("keyEditDialogValue"),this.keyEditDialogEasing=document.getElementById("keyEditDialogEasing"),this.keyEditDialogOK=document.getElementById("keyEditDialogOK"),this.keyEditDialogCancel=document.getElementById("keyEditDialogCancel"),this.keyEditDialogDelete=document.getElementById("keyEditDialogDelete");var a=this;this.keyEditDialogOK.addEventListener("click",function(){a.applyKeyEditDialog(),a.hideKeyEditDialog()},!1),this.keyEditDialogCancel.addEventListener("click",function(){a.hideKeyEditDialog()},!1),this.keyEditDialogDelete.addEventListener("click",function(){a.deleteSelectedKeys(),a.rebuildSelectedTracks(),a.hideKeyEditDialog()},!1),this.hideKeyEditDialog()},Timeline.prototype.applyKeyEditDialog=function(){var t=Number(this.keyEditDialogValue.value);if(!isNaN(t)){for(var i=this.keyEditDialogEasing.options[this.keyEditDialogEasing.selectedIndex],e=Timeline.easingMap[i.value],s=0;s<this.selectedKeys.length;s++)this.selectedKeys[s].easing=e,this.selectedKeys[s].value=t;this.rebuildSelectedTracks()}},Timeline.prototype.showKeyEditDialog=function(t,i){this.keyEditDialogValue.value=this.selectedKeys[0].value;for(var e=0;e<this.keyEditDialogEasing.options.length;e++){var s=this.keyEditDialogEasing.options[e],h=Timeline.easingMap[s.value];if(h==this.selectedKeys[0].easing){this.keyEditDialogEasing.selectedIndex=e;break}}this.keyEditDialog.style.left=Math.max(50,t-200)+"px",this.keyEditDialog.style.top=i-50+"px",this.keyEditDialog.style.display="block",this.keyEditDialogValue.focus()},Timeline.prototype.deleteSelectedKeys=function(){for(var t=0;t<this.selectedKeys.length;t++){var i=this.selectedKeys[t],e=i.track.keys.indexOf(i);i.track.keys.splice(e,1)}this.rebuildSelectedTracks()},Timeline.prototype.hideKeyEditDialog=function(){this.keyEditDialog.style.display="none"},Timeline.prototype.sortTrackKeys=function(t){t.keys.sort(function(t,i){return t.time-i.time});for(var i=0;i<t.keys.length;i++)t.keys[i].time+" "},Timeline.prototype.rebuildSelectedTracks=function(){for(var t=0;t<this.selectedKeys.length;t++)this.rebuildTrackAnimsFromKeys(this.selectedKeys[t].track);this.save()},Timeline.prototype.rebuildTrackAnimsFromKeys=function(t){var i,e=[];for(i=0;i<t.anims.length;i++){var s=this.anims.indexOf(t.anims[i]);e.push(t.anims[i]),this.anims.splice(s,1)}if(t.anims.splice(0,t.anims.length),0!==t.keys.length){var h=t.keys[0].time,a=t.keys[0].time,l=t.keys[0].value,r=Timeline.Easing.Linear.EaseNone;for(i=0;i<t.keys.length;i++){var c=t.keys[i],o={timeline:this,target:t.target,propertyName:t.propertyName,startValue:l,endValue:c.value,delay:h,startTime:a,endTime:c.time,easing:r};t.anims.push(o),this.anims.push(o),h=0,a=c.time,l=c.value,r=c.easing}}},Timeline.prototype.exportCode=function(){for(var t="",i=0;i<this.tracks.length;i++){var e=this.tracks[i];if("object"!=e.type&&0!==e.anims.length){t+='anim("'+e.parent.name+'",'+e.parent.name+")";for(var s=0;s<e.anims.length;s++){var h=e.anims[s];t+=".to(",h.delay&&(t+=h.delay+","),t+='{"'+h.propertyName+'":'+h.endValue+"}",t+=","+(h.endTime-h.startTime),h.easing!=Timeline.Easing.Linear.EaseNone&&(t+=", Timeline.Easing."+Timeline.easingFunctionToString(h.easing)),t+=")"}t+=";\n"}}prompt("Copy this:",t)},Timeline.prototype.save=function(){for(var t={},i=0;i<this.tracks.length;i++){for(var e=this.tracks[i],s=[],h=0;h<e.keys.length;h++)s.push({time:e.keys[h].time,value:e.keys[h].value,easing:Timeline.easingFunctionToString(e.keys[h].easing)});t[e.id]=s}localStorage["timeline.js.settings.canvasHeight"]=this.canvasHeight,localStorage["timeline.js.settings.timeScale"]=this.timeScale,localStorage["timeline.js.data."+this.name]=JSON.stringify(t)},Timeline.prototype.load=function(){localStorage["timeline.js.settings.canvasHeight"]&&(this.canvasHeight=localStorage["timeline.js.settings.canvasHeight"]),localStorage["timeline.js.settings.timeScale"]&&(this.timeScale=localStorage["timeline.js.settings.timeScale"]);var t=localStorage["timeline.js.data."+this.name];if(t)for(var i=JSON.parse(t),e=0;e<this.tracks.length;e++){var s=this.tracks[e];if(i[s.id]&&"property"==s.type){var h=i[s.id];s.keys=[];for(var a=0;a<h.length;a++)s.keys.push({time:h[a].time,value:h[a].value,easing:Timeline.stringToEasingFunction(h[a].easing),track:s});this.rebuildTrackAnimsFromKeys(s)}}};